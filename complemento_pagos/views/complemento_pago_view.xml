<?xml version="1.0" encoding="utf-8"?>
<odoo>

    <data>


        <record id="cfdipagos_paperformat" model="report.paperformat">
            <field name="page_height">0</field>
            <field name="page_width">0</field>
            <field name="header_spacing">35</field>
            <field name="margin_top">10</field>
            <field name="margin_right">7</field>
            <field name="margin_bottom">10</field>
            <field name="margin_left">7</field>
            <field name="header_line">False</field>
            <field name="name">US Letter Pagos</field>
            <field name="orientation">Portrait</field>
            <field name="dpi">90</field>
            <field name="default">True</field>
            <field name="format">Letter</field>
        </record>

        <report 
            id="complemento_pagos_mx"
            model="cfdi.timbres.sat"
            string="Pagos CFDI"
            report_type="qweb-pdf"
            name="complemento_pagos.report_cfdipagosmx"
            file="complemento_pagos.report_cfdipagosmx" 
            attachment_use="False"
            attachment="((object.name or '').replace('/','')+'.pdf')" />


        <record id="complemento_pagos_mx" model="ir.actions.report.xml">
            <field name="paperformat_id" ref="complemento_pagos.cfdipagos_paperformat"/>
            <field name="print_report_name"><![CDATA[((object.name or 'Pagos CFDI').replace('/','')+'.pdf')]]></field>
        </record>

    </data>

    <data>

        <template id="report_cfdipagos_mx_body">
            <t t-set="cfdiDatas" t-value="doc.get_xml_cfdi()" />
            <t t-set="compAtrib" t-value="cfdiDatas.get('compAtrib')" />

            <t t-set="receptorAtrib" t-value="cfdiDatas.get('receptorAtrib')" />
            <t t-set="nodosPagos" t-value="cfdiDatas.get('nodosPagos')" />
            <t t-set="timbreAtrib" t-value="cfdiDatas.get('timbreAtrib')" />
            <t t-set="urlQR" t-value="doc.getUrlQR(timbreAtrib.get('SelloCFD'))" />

            <div class="row">
                <div class="col-xs-7">
                    <strong t-field="doc.company_id.partner_id.name" /><br />
                    <strong>RFC: </strong><span t-field="doc.company_id.partner_id.vat" /> &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;<strong>No. de Certificado: </strong><span t-esc="compAtrib.get('NoCertificado')" /> <br />
                    <div class="bg_font_color">
                        <span>Lugar y Fecha de Expedición: </span> <span t-esc="compAtrib.get('LugarExpedicion')" /> - <span t-field="doc.journal_id.codigo_postal_id.municipio_id" /> a <span t-esc="compAtrib.get('Fecha')" /></div>
                    <div class="bg_font_color">
                        <span>Régimen: </span><span t-field="doc.company_id.partner_id.regimen_id.clave" /> - <span t-field="doc.company_id.partner_id.regimen_id.name" />
                    </div>
                </div>
                <div class="col-xs-5 bg_color">
                    <div class="row">
                        <div class="col-xs-12"> &amp;nbsp; </div>
                        <div class="col-xs-5">
                            <span>Comprobante: </span><strong><t t-esc="compAtrib.get('TipoDeComprobante')" /> - Pago </strong>
                        </div>
                        <div class="col-xs-7">
                            <span>Serie y Folio: <strong t-esc="compAtrib.get('Serie')" /> &amp;nbsp; <strong t-esc="compAtrib.get('Folio')" /> </span>
                        </div>
                        <div class="col-xs-12"> &amp;nbsp; </div>
                    </div>
                </div>
            </div>
            <br />
            <div class="row">
                <div class="col-xs-12 bg_border_top"> &amp;nbsp; </div>
            </div>
            <div class="row">
                <table class="table table-condensed">
                    <tr>
                        <th class="bg_theme_color text-center"><strong>INFORMACIÓN DEL CLIENTE</strong></th>
                        <th class="bg_theme_color text-center"><strong>INFORMACIÓN ADICIONAL</strong></th>
                    </tr>
                    <tr>
                        <td>
                            <strong t-esc="receptorAtrib.get('Nombre')" /><br />
                            <strong>RFC: </strong><span t-esc="receptorAtrib.get('Rfc')" /><br />
                        </td>
                        <td class="text-left">
                            <strong>Version: </strong><span t-esc="compAtrib.get('Version')" /> &amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;
                            <strong>Moneda: </strong> <span t-esc="compAtrib.get('Moneda')" /> &amp;nbsp;<br />
                            <strong>Uso CFDI: </strong> <span t-esc="receptorAtrib.get('UsoCFDI')" /> - <span> Por Definir</span> &amp;nbsp;<br />
                        </td>
                    </tr>
                </table>
            </div>
            <br />
            <div class="row">
                <table class="table table-condensed">
                    <tr>
                        <th colspan="6" class="bg_theme_color text-center"><strong>CONCEPTOS DEL COMPROBANTE</strong></th>
                    </tr>
                    <tr>
                        <th><strong>CLAVE</strong></th>
                        <th><strong>UNIDAD</strong></th>
                        <th><strong>DESCRIPCIÓN</strong></th>
                        <th><strong>CANTIDAD</strong></th>
                        <th><strong>P. UNITARIO.</strong></th>
                        <th><strong>IMPORTE</strong></th>
                    </tr>
                    <tr>
                        <td class="bg_font_color"><span>84111506</span></td>
                        <td class="bg_font_color"><span>ACT</span></td>
                        <td class="bg_font_color"><span>Pago</span></td>
                        <td class="bg_font_color text-center"><span>1</span></td>
                        <td class="bg_font_color text-center"><span>$ 0.0</span></td>
                        <td class="bg_font_color text-center"><span>$ 0.0</span></td>
                    </tr>
                    <tr>
                        <td><span>&amp;nbsp;</span></td>
                        <td><span>&amp;nbsp;</span></td>
                        <td><span>&amp;nbsp;</span></td>
                        <td><span>&amp;nbsp;</span></td>
                        <td class="bg_font_color text-right"><strong>SUBTOTAL</strong></td>
                        <td class="text-center"><span>$ 0.0</span></td>
                    </tr>
                    <tr>
                        <td><span>&amp;nbsp;</span></td>
                        <td><span>&amp;nbsp;</span></td>
                        <td><span>&amp;nbsp;</span></td>
                        <td><span>&amp;nbsp;</span></td>
                        <td class="bg_font_color text-right"><strong>TOTAL</strong></td>
                        <td class="text-center"><span>$ 0.0</span></td>
                    </tr>
                </table>
            </div>
            <t t-foreach="nodosPagos" t-as="nodosPago">
                <t t-set="pagosAtrib" t-value="nodosPago.get('pagosAtrib')" />
                <t t-set="monto" t-value="pagosAtrib.get('Monto')" />
                <t t-set="monedap" t-value="pagosAtrib.get('MonedaP')" />
                <div class="row">
                    <table class="table table-condensed">
                        <tr>
                            <th colspan="10" class="bg_theme_color text-center"><strong>RECIBO ELECTRONICO DE PAGOS</strong></th>
                        </tr>
                        <tr>
                            <td style="width: 27%;">
                                <strong class="">Num. Oper.</strong><br/><span class="bg_font_color" t-esc="pagosAtrib.get('NumOperacion', ' ')" />
                            </td>
                            <td colspan="2">
                                <strong>Fecha Pago</strong> <br/><span class="bg_font_color" t-esc="pagosAtrib.get('FechaPago', ' ')" />
                            </td>
                            <td colspan="4">
                                <strong>Forma Pago</strong> <br/><span class="bg_font_color" t-esc="doc.getFormaPago(pagosAtrib.get('FormaDePagoP'))" />
                            </td>
                            <td>
                                <strong>Moneda</strong> <br/><span class="bg_font_color" t-esc="pagosAtrib.get('MonedaP', ' ')" />
                            </td>
                            <td>
                                <strong>T. C.</strong> <br/><span class="bg_font_color" t-esc="pagosAtrib.get('TipoCambioP', '')" /> &amp;nbsp;
                            </td>
                            <td>
                                <strong>Total Pago</strong> <br/>$ <span class="bg_font_color" t-esc="pagosAtrib.get('Monto', ' ')" />
                            </td>
                        </tr>
                        <tr>
                            <td colspan="2">
                                <strong>RFC Ordenante: </strong> <span class="bg_font_color" t-esc="pagosAtrib.get('RfcEmisorCtaOrd')" />&amp;nbsp;
                            </td>
                            <td colspan="4">
                                <strong>Cuenta Ordenante: </strong> <span class="bg_font_color" t-esc="pagosAtrib.get('CtaOrdenante')" />&amp;nbsp;
                            </td>
                            <td colspan="4">
                                <strong>Banco Ordenante Ext: </strong> <span class="bg_font_color" t-esc="pagosAtrib.get('NomBancoOrdExt')" />&amp;nbsp;
                            </td>
                        </tr>
                        <tr>
                            <td colspan="2">
                                <strong>RFC Beneficiario: </strong> <span class="bg_font_color" t-esc="pagosAtrib.get('RfcEmisorCtaBen')" />&amp;nbsp;
                            </td>
                            <td colspan="4">
                                <strong>Cuenta Beneficiario: </strong> <span class="bg_font_color" t-esc="pagosAtrib.get('CtaBeneficiario')" />&amp;nbsp;
                            </td>
                            <td colspan="4">
                                <strong>Tipo Cadena Pago: </strong><t t-if="pagosAtrib.get('TipoCadPago')"> <span class="bg_font_color" t-esc="pagosAtrib.get('TipoCadPago')" /> <span class="bg_font_color">- SPEI </span> </t> &amp;nbsp;
                            </td>
                        </tr>
                        <t t-if="pagosAtrib.get('TipoCadPago')">
                            <tr>
                                <td colspan="10">
                                    <div class="row">
                                        <div class="col-xs-12 text-left">
                                            <strong>Certificado: </strong><br/>
                                            <span class="bg_font_color nowrap" style="font-size:8px; display:block; width:800px !important; word-wrap:break-word;" t-esc="pagosAtrib.get('CertPago')" />
                                        </div>
                                    </div>
                                </td>
                            </tr>
                            <tr>
                                <td colspan="5" style="width:50%;">
                                    <div class="row">
                                        <div class="col-xs-12 text-left">
                                            <strong>Cadena: </strong><br/>
                                            <span class="bg_font_color nowrap" style="font-size:8px; display:block; width:350px !important; word-wrap:break-word;" t-esc="pagosAtrib.get('CadPago')" />
                                        </div>
                                    </div>
                                </td>
                                <td colspan="5" style="width:50%;">
                                    <div class="row">
                                        <div class="col-xs-12 text-left">
                                            <strong>Sello Pago: </strong><br/>
                                            <span class="bg_font_color nowrap" style="font-size:8px; display:block; width:350px !important; word-wrap:break-word;" t-esc="pagosAtrib.get('SelloPago')" /><br />
                                        </div>
                                    </div>
                                </td>
                            </tr>
                        </t>
                        <tr>
                            <th colspan="10" class="border-bottom text-left" >
                                <strong>Cantidad Letra: </strong> <span class="bg_font_color" t-esc="doc.cfdi_amount_to_text(monedap, monto)" /><br/>
                            </th>
                        </tr>
                        <tr><th colspan="10" class="border-bottom border-left border-right text-center" >CFDI RELACIONADOS</th></tr>
                        <tr>
                            <th class="border-bottom border-left border-right text-center" style="width: 27%;">UUID</th>
                            <th class="border-bottom border-right text-center">Folio</th>
                            <th class="border-bottom border-right text-center">Metodo</th>
                            <th class="border-bottom border-right text-center">Moneda</th>
                            <th class="border-bottom border-right text-center">T. C. </th>
                            <th class="border-bottom border-right text-center">No. Parc.</th>
                            <th class="border-bottom border-right text-center">Total</th>
                            <th class="border-bottom border-right text-center">Saldo Anterior</th>
                            <th class="border-bottom border-right text-center">Monto Pagado</th>
                            <th class="border-bottom border-right text-center">Saldo Pendiente</th>
                        </tr>
                        <t t-foreach="nodosPago.get('doctosAtrib')" t-as="doctoAtrib">
                            <tr>
                                <td class="bg_font_color border-bottom border-left border-right" style="width: 27%;"><span t-esc="doctoAtrib.get('IdDocumento')" /></td>
                                <td class="bg_font_color border-bottom border-right"><span t-esc="doctoAtrib.get('Folio')" /></td>
                                <td class="bg_font_color border-bottom border-right"><span t-esc="doctoAtrib.get('MetodoDePagoDR')" /></td>
                                <td class="bg_font_color border-bottom border-right"><span t-esc="doctoAtrib.get('MonedaDR', '')" /></td>
                                <td class="bg_font_color border-bottom border-right text-right">$ <span t-esc="doctoAtrib.get('TipoCambioDR', '')" /></td>
                                <td class="bg_font_color border-bottom border-right text-center"><span t-esc="doctoAtrib.get('NumParcialidad', '')" /></td>
                                <td class="bg_font_color border-bottom border-right text-right">$ <span t-esc="doc.get_total_cfdi(doctoAtrib.get('IdDocumento', ''))" /></td>
                                <td class="bg_font_color border-bottom border-right text-right">$ <span t-esc="doctoAtrib.get('ImpSaldoAnt', '')" /></td>
                                <td class="bg_font_color border-bottom border-right text-right">$ <span t-esc="doctoAtrib.get('ImpPagado', '')" /></td>
                                <td class="bg_font_color border-bottom border-right text-right">$ <span t-esc="doctoAtrib.get('ImpSaldoInsoluto', '')" /></td>
                            </tr>
                        </t>
                    </table>
                </div>
            </t>
            <div class="row font_inv">
                <div class="col-xs-12 text-center border-bottom"><h2 class="bg_h2">TIMBRE FISCAL</h2></div>
                <div class="col-xs-2 border-left border-bottom border-right text-center">
                    <strong>PAC</strong> <br/><span class="bg_font_color" t-esc="timbreAtrib.get('RfcProvCertif', ' ')" />
                </div>
                <div class="col-xs-4 border-bottom border-right text-center">
                    <strong>Folios Fiscal</strong> <br/><span class="bg_font_color" t-esc="timbreAtrib.get('UUID', ' ')" />
                </div>
                <div class="col-xs-3 border-bottom border-right text-center">
                    <strong>No. Certificado SAT</strong> <br/><span class="bg_font_color" t-esc="timbreAtrib.get('NoCertificadoSAT', ' ')" />
                </div>
                <div class="col-xs-3 border-bottom border-right text-center">
                    <strong>Fecha Certificación</strong> <br/><span class="bg_font_color" t-esc="timbreAtrib.get('FechaTimbrado', ' ')" />
                </div>
            </div>
            <div class="row font_inv">
                <div class="col-xs-3 fill border-left border-right text-center">
                    <img t-att-src="'/report/barcode/?type=%s&amp;value=%s&amp;width=%s&amp;height=%s' % ('QR', urlQR, 200, 200)" style="width:140px;height:140px"/>
                </div>
                <div class="col-xs-3 fill text-center" >
                    <strong>Sello Digital del Emisor</strong> <br/>
                    <span class="bg_font_color text-left" style="font-size:8px; display:block; width:100% !important; word-wrap:break-word;" t-esc="timbreAtrib.get('SelloCFD')" /> <br />
                </div>
                <div class="col-xs-3 fill text-center">
                    <strong>Sello Digital del SAT</strong> <br/>
                    <span class="bg_font_color text-left" style="font-size:8px; display:block; width:100% !important; word-wrap:break-word;" t-esc="timbreAtrib.get('SelloSAT')" /> <br />
                </div>
                <div class="col-xs-3 fill border-right text-center">
                    <strong>Cadena Original</strong> <br/>
                    <span class="bg_font_color text-left" style="font-size:8px; display:block; width:100% !important; word-wrap:break-word;" t-esc="doc.cfdi_cadena_sat" /> <br />
                </div>
                <div class="col-xs-12 border-left border-bottom border-top border-right text-left">Este documento es una representación impresa de un CFDI<br/></div>
            </div>
            <br />

        </template>


        <template id="report_cfdipagos_mx_document">
            <t t-call="bias_base_report.custom_external_layout">
                <t t-set="doc" t-value="doc.with_context({'lang':doc.partner_id.lang})" />
                <div class="page">
                    <t t-call="complemento_pagos.report_cfdipagos_mx_body" />
                </div>
            </t>
        </template>
        
        <template id="report_cfdipagosmx">
            <t t-call="report.html_container">
                <t t-foreach="docs" t-as="doc">
                    <t t-call="complemento_pagos.report_cfdipagos_mx_document" t-lang="doc.partner_id.lang"/>
                </t>
            </t>
        </template>

    </data>


</odoo>